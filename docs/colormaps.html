<!DOCTYPE html>

<html>
<head>
  <title>colormaps.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>colormaps.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h3 id="color-maps">Color Maps</h3>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>A colormap is an array of colors. Maps are extremely useful:</p>
<ul>
<li>Performance: Maps are created once, reducing the calls to primitives
whenever a color is changed.</li>
<li>Space Effeciency: They <em>vastly</em> reduce the number of colors used.</li>
<li>Data: Their index provides a MatLab/NumPy/NetLogo “color as data” feature.
Ex: “Heat” may be mapped to a gradient from green to red.</li>
</ul>
<p>And you can simply make your own array of legal colors, works fine.
And protoMap will even do prototype magic to turn your legal color array
into a ColorMap.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
ColorMaps  = {

  <span class="hljs-attribute">ColorMap</span>: <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ColorMap</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Array</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>colorsArray contains either arrays or legal colors.
The type arg specifies the colors in the map.</p>
<p>If the special case of colorsArray = a number, an rgb
color cube of that dimension will be created.</p>
<p>If indexToo then create an object lookup table for direct finding
of the color’s index in the map. Also, TypedColors have two additional
properties: this colormap and the index of the color in the map.</p>
<p>If colorsArray contains colors, not an array, and the type differs from
the desired type, conversion of the color to the desired color will occur
but with a warning message in the console.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">( colorsArray, <span class="hljs-property">@type</span>=<span class="hljs-string">"typed"</span>, indexToo=(type <span class="hljs-keyword">is</span> <span class="hljs-string">"typed"</span>) )</span>-&gt;</span>
      <span class="hljs-keyword">super</span>(<span class="hljs-number">0</span>)
      <span class="hljs-property">@index</span> = {} <span class="hljs-keyword">if</span> indexToo
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> colorsArray <span class="hljs-keyword">is</span> <span class="hljs-string">"number"</span>
        <span class="hljs-property">@cube</span> = colorsArray
        colorsArray = ColorMaps.permuteColors <span class="hljs-property">@cube</span>
      type0 = Color.colorType(colorsArray[<span class="hljs-number">0</span>])
      <span class="hljs-keyword">if</span> type0 <span class="hljs-keyword">and</span> (type0 <span class="hljs-keyword">isnt</span> type)
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Primitive color conversion in color map. OK?"</span>
        colorsArray = (Color.colorToArray(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> colorsArray)</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>After this, colorsArray has arrays or colors matching type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-property">@appendColor</span> color, type <span class="hljs-keyword">for</span> color <span class="hljs-keyword">in</span> colorsArray</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Append a color to the the map. color is either an array or a valid color.
If index object exists keep an index entry pointing to the color index.
If type is “typed” add map, index properties to each typedColor.</p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Validate “array” which can be standard or typed array of length 3 or 4</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">isValidArray</span>: <span class="hljs-function"><span class="hljs-params">(array)</span> -&gt;</span>
      (u.isArray(array) <span class="hljs-keyword">or</span> array.buffer) <span class="hljs-keyword">and</span> (array.length <span class="hljs-keyword">in</span> [<span class="hljs-number">3.</span><span class="hljs-number">.4</span>])

    <span class="hljs-attribute">appendColor</span>: <span class="hljs-function"><span class="hljs-params">(color)</span> -&gt;</span>
      <span class="hljs-keyword">if</span> <span class="hljs-property">@isValidArray</span> color <span class="hljs-comment"># ToDo: better to use type comparison?</span>
        color = Color.arrayToColor color, <span class="hljs-property">@type</span>
      <span class="hljs-property">@index</span>[ <span class="hljs-property">@indexKey</span>(color) ] = <span class="hljs-property">@length</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@index</span>
      <span class="hljs-keyword">if</span> <span class="hljs-property">@type</span> <span class="hljs-keyword">is</span> <span class="hljs-string">"typed"</span>
        color.ix = <span class="hljs-property">@length</span>
        color.map = @
      <span class="hljs-property">@push</span> color
      color <span class="hljs-comment"># was null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Given a color in the map, return the key it uses in the index object.
The value will be the index of the color in the map/array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">indexKey</span>: <span class="hljs-function"><span class="hljs-params">(color)</span> -&gt;</span> <span class="hljs-comment"># make css strings lower case?</span>
      <span class="hljs-keyword">if</span> <span class="hljs-property">@type</span> <span class="hljs-keyword">is</span> <span class="hljs-string">"typed"</span> <span class="hljs-keyword">then</span> color.pixel <span class="hljs-keyword">else</span> color</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Use the indexKey to test two map color’s equality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">colorsEqual</span>: <span class="hljs-function"><span class="hljs-params">(color1, color2)</span> -&gt;</span>
      <span class="hljs-property">@indexKey</span>(color1) <span class="hljs-keyword">is</span> <span class="hljs-property">@indexKey</span>(color2)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Get a random index or color from this map given the
input range, defaults to entire map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">randomIndex</span>: <span class="hljs-function"><span class="hljs-params">(start=<span class="hljs-number">0</span>, stop=<span class="hljs-property">@length</span>)</span> -&gt;</span> u.randomInt2 start, stop
    <span class="hljs-attribute">randomColor</span>: <span class="hljs-function"><span class="hljs-params">(start=<span class="hljs-number">0</span>, stop=<span class="hljs-property">@length</span>)</span> -&gt;</span> @[ <span class="hljs-property">@randomIndex</span> start, stop ]</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Use Array.sort, augmented by updating index if present
and color.ix for typedColors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">sort</span>: <span class="hljs-function"><span class="hljs-params">(compareFcn)</span> -&gt;</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@length</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
      <span class="hljs-keyword">super</span> compareFcn
      <span class="hljs-keyword">if</span> <span class="hljs-property">@index</span> <span class="hljs-keyword">then</span> <span class="hljs-property">@index</span>[ <span class="hljs-property">@indexKey</span>(color) ] = i <span class="hljs-keyword">for</span> color,i <span class="hljs-keyword">in</span> @
      color.ix = i <span class="hljs-keyword">for</span> color,i <span class="hljs-keyword">in</span> @ <span class="hljs-keyword">if</span> @[<span class="hljs-number">0</span>].ix
      <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Lookup color in map, returning index or undefined if not found</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">lookup</span>: <span class="hljs-function"><span class="hljs-params">(color)</span> -&gt;</span>
      <span class="hljs-keyword">return</span> <span class="hljs-property">@index</span>[ <span class="hljs-property">@indexKey</span>(color) ] <span class="hljs-keyword">if</span> <span class="hljs-property">@index</span>
      <span class="hljs-keyword">for</span> c,i <span class="hljs-keyword">in</span> @
        <span class="hljs-keyword">return</span> i <span class="hljs-keyword">if</span> <span class="hljs-property">@colorsEqual</span>(color, c)
      <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Return the map index or color proportional to the value between min, max.
This is a linear interpolation based on the map indices.
The optional minColor, maxColor args are for using a subset of the map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">scaleIndex</span>: <span class="hljs-function"><span class="hljs-params">(number, min, max, minColor = <span class="hljs-number">0</span>, maxColor = <span class="hljs-property">@length</span>-<span class="hljs-number">1</span>)</span> -&gt;</span>
      scale = u.lerpScale number, min, max <span class="hljs-comment"># (number-min)/(max-min)</span>
      Math.round(u.lerp minColor, maxColor, scale)
    <span class="hljs-attribute">scaleColor</span>: <span class="hljs-function"><span class="hljs-params">(number, min, max, minColor = <span class="hljs-number">0</span>, maxColor = <span class="hljs-property">@length</span>-<span class="hljs-number">1</span>)</span> -&gt;</span>
      @[ <span class="hljs-property">@scaleIndex</span> number, min, max, minColor, maxColor ]</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Find closest index/value in an RGB color cube by direct lookup in cube.
Much faster than more general findClosest. Error if not cube</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">closestCubeIndex</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span>
      u.error <span class="hljs-string">"closestCubeIndex: not a color cube"</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@cube</span>
      step = <span class="hljs-number">255</span>/(<span class="hljs-property">@cube</span>-<span class="hljs-number">1</span>)
      [rLoc, gLoc, bLoc] = (Math.round(c/step) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> [r, g, b])
      rLoc + gLoc*<span class="hljs-property">@cube</span> + bLoc*<span class="hljs-property">@cube</span>*<span class="hljs-property">@cube</span>
    <span class="hljs-attribute">closestCubeColor</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span> @[ <span class="hljs-property">@closestCubeIndex</span> r, g, b ]</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Find the index/color closest to this r,g,b; using Color.rgbDistance.
Note: slow for large maps unless color cube or in index or exact match.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">findClosestIndex</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span> <span class="hljs-comment"># alpha not in rgbDistance function</span>
      <span class="hljs-keyword">return</span> <span class="hljs-property">@closestCubeIndex</span> r, g, b <span class="hljs-keyword">if</span> <span class="hljs-property">@cube</span>
      <span class="hljs-keyword">return</span> ix <span class="hljs-keyword">if</span> ( ix=<span class="hljs-property">@lookup</span>(Color.arrayToColor [r,g,b], <span class="hljs-property">@type</span>) )</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>return ix if @index and ( ix=@lookup(Color.arrayToColor [r,g,b], @type) )</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      minDist = Infinity
      ixMin = <span class="hljs-number">0</span>
      <span class="hljs-keyword">for</span> color, i <span class="hljs-keyword">in</span> @
        [r0, g0, b0] = Color.colorToArray color
        d = Color.rgbDistance r0, g0, b0, r, g, b
        <span class="hljs-keyword">if</span> d &lt; minDist
          minDist = d
          ixMin = i
      ixMin
    <span class="hljs-attribute">findClosestColor</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span>  @[ <span class="hljs-property">@findClosestIndex</span> r, g, b ]</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Utilities for creating color maps, inspired <a href="https://github.com/bpostlethwaite/colormap">by this repo</a>.
Do <em>not</em> call these with “new”, they will call new Colormap themselves.</p>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Ask the browser to use the canvas gradient feature
to create nColors given the gradient color stops and locs.</p>
<p>Stops are css strings or rgba arrays. Locs are floats from 0-1</p>
<p>This is a really powerful technique, see:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient">Mozilla Gradient Doc</a></li>
<li><a href="http://www.colorzilla.com/gradient-editor/">Colorzilla Gradient Editor</a></li>
<li><a href="https://github.com/bpostlethwaite/colormap">GitHub ColorMap Project</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-attribute">gradientUint8Array</span>: <span class="hljs-function"><span class="hljs-params">(nColors, stops, locs)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Convert css versions of the stops if they are rgb arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stops = (Color.arrayToColor a, <span class="hljs-string">"css"</span> <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> stops) <span class="hljs-keyword">if</span> u.isArray stops[<span class="hljs-number">0</span>]
    locs = u.aRamp <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, stops.length <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> locs?
    ctx = u.createCtx nColors, <span class="hljs-number">1</span>
    grad = ctx.createLinearGradient <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, nColors, <span class="hljs-number">0</span>
    grad.addColorStop locs[i], stops[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..stops.length]
    ctx.fillStyle = grad
    ctx.fillRect <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, nColors, <span class="hljs-number">1</span>
    u.ctxToImageData(ctx).data</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>gradientRgbaArray: (nColors, stops, locs) -&gt;
  id = @gradientUint8Array nColors, stops, locs
  ( [ id[i], id[i+1], id[i+2], id[i+3] ] for i in [0…id.length] by 4 )</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">gradientUint8sArray</span>: <span class="hljs-function"><span class="hljs-params">(nColors, stops, locs)</span> -&gt;</span>
    <span class="hljs-property">@uintArrayToUint8s</span>(<span class="hljs-property">@gradientUint8Array</span> nColors, stops, locs)
  <span class="hljs-attribute">gradientPixelArray</span>: <span class="hljs-function"><span class="hljs-params">(nColors, stops, locs)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Uint32Array( <span class="hljs-property">@gradientUint8Array</span>(nColors, stops, locs).buffer )</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Convert Uint8Array into Array of 4 element uint8s subarrays.
Useful converting ImageData objects like gradients to color arrays.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">uintArrayToUint8s</span>: <span class="hljs-function"><span class="hljs-params">(uint8Array)</span> -&gt;</span>
    ( uint8Array.subarray(i,i+<span class="hljs-number">4</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..uint8Array.length] <span class="hljs-keyword">by</span> <span class="hljs-number">4</span> )</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Utility to permute 3 arrays.</p>
<ul>
<li>If any arg is array, no change made.</li>
<li>If any arg is 1, replace with [max].</li>
<li>If any arg is n&gt;1, replace with u.aIntRamp(0,max,n).</li>
</ul>
<p>Resulting array is an array of arrays of len 3 permuting A1, A2, A3
Used by rgbColorMap and hslColorMap</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">permuteColors</span>: <span class="hljs-function"><span class="hljs-params">(A1, A2=A1, A3=A2, max=[<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>])</span> -&gt;</span>
    [A1, A2, A3] = <span class="hljs-keyword">for</span> A, i <span class="hljs-keyword">in</span> [A1, A2, A3] <span class="hljs-comment"># multi-line comprehension</span>
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> A <span class="hljs-keyword">is</span> <span class="hljs-string">"number"</span>
        <span class="hljs-keyword">if</span> A <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> [max[i]] <span class="hljs-keyword">else</span> u.aIntRamp(<span class="hljs-number">0</span>, max[i], A)
      <span class="hljs-keyword">else</span> A
    <span class="hljs-property">@permuteArrays</span> A1, A2, A3</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Permute simple arrays w/o conversions above.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">permuteArrays</span>: <span class="hljs-function"><span class="hljs-params">(A1, A2=A1, A3=A2)</span> -&gt;</span>
    array = []
    ((array.push [a1,a2,a3] <span class="hljs-keyword">for</span> a1 <span class="hljs-keyword">in</span> A1) <span class="hljs-keyword">for</span> a2 <span class="hljs-keyword">in</span> A2) <span class="hljs-keyword">for</span> a3 <span class="hljs-keyword">in</span> A3
    array</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Create a gray map of gray values (gray: r=g=b)
These are typically 256 entries but can be smaller
by passing a size parameter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">grayArray</span>: <span class="hljs-function"><span class="hljs-params">(size = <span class="hljs-number">256</span>)</span> -&gt;</span> ( [i,i,i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> u.aIntRamp <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, size )
  <span class="hljs-attribute">grayColorMap</span>: <span class="hljs-function"><span class="hljs-params">(size=<span class="hljs-number">256</span>, type=<span class="hljs-string">"typed"</span>, indexToo=<span class="hljs-literal">false</span>)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-property">@ColorMap</span> <span class="hljs-property">@grayArray</span>(size), type, indexToo</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Create a colormap by permuted rgb values. R, G, B can be either a number,
(the number of steps beteen 0-255), or an array of values to use
for the color.  Ex: R = 3, corresponds to [0, 128, 255]
The resulting map permutes the R, G, V values.  Thus if
R=G=B=4, the resulting map has 4<em>4</em>4=64 colors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbColorMap</span>: <span class="hljs-function"><span class="hljs-params">(R, G=R, B=R, type=<span class="hljs-string">"typed"</span>, indexToo=<span class="hljs-literal">true</span>)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> R <span class="hljs-keyword">is</span> <span class="hljs-string">"number"</span>) <span class="hljs-keyword">and</span> (R <span class="hljs-keyword">is</span> G <span class="hljs-keyword">is</span> B)
      <span class="hljs-keyword">new</span> <span class="hljs-property">@ColorMap</span> R, type, indexToo <span class="hljs-comment"># lets ColorMap know its a color cube</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">new</span> <span class="hljs-property">@ColorMap</span> <span class="hljs-property">@permuteColors</span>(R, G, B), type, indexToo</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Create an hsl map, inputs similar to above.  Convert the
HSL values to css, default to bright hue ramp.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">hslColorMap</span>: <span class="hljs-function"><span class="hljs-params">(H, S=<span class="hljs-number">1</span>, L=<span class="hljs-number">1</span>, type=<span class="hljs-string">"css"</span>, indexToo=<span class="hljs-literal">false</span>)</span> -&gt;</span>
    hslArray = <span class="hljs-property">@permuteColors</span>(H, S, L, [<span class="hljs-number">359</span>,<span class="hljs-number">100</span>,<span class="hljs-number">50</span>])
    cssArray = (Color.hslString a... <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> hslArray)
    <span class="hljs-keyword">new</span> <span class="hljs-property">@ColorMap</span> cssArray, type, indexToo</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Use gradient to build an rgba array, then convert to colormap</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">gradientColorMap</span>: <span class="hljs-function"><span class="hljs-params">(nColors, stops, locs, type=<span class="hljs-string">"typed"</span>, indexToo=<span class="hljs-literal">true</span>)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-property">@ColorMap</span> <span class="hljs-property">@gradientUint8sArray</span>(nColors, stops, locs), type, indexToo</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Create a map with a random set of colors.
Sometimes useful to sort by intensity afterwards.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">randomColorMap</span>: <span class="hljs-function"><span class="hljs-params">(nColors, type=<span class="hljs-string">"typed"</span>, indexToo=<span class="hljs-literal">false</span>)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>new @ColorMap (Color.randomRgba() for i in [0…nColors]), type, indexToo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">new</span> <span class="hljs-property">@ColorMap</span> (Color.randomRgb() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..nColors]), type, indexToo</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Create alpha map of the given base r,g,b color,
with nOpacity opacity values, default to all 256</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">alphaColorMap</span>: <span class="hljs-function"><span class="hljs-params">(rgb, nOpacities = <span class="hljs-number">256</span>, type=<span class="hljs-string">"typed"</span>, indexToo=<span class="hljs-literal">true</span>)</span> -&gt;</span>
    alphaArray = ( u.clone(rgb).push a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> u.aIntRamp <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, nOpacities )
    <span class="hljs-keyword">new</span> <span class="hljs-property">@ColorMap</span> alphaArray rgb, nOpacities, type, indexToo</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3 id="two-prototype-conversion-primitive-color-maps-">Two prototype conversion primitive color maps.</h3>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Factory: convert JS array of valid colors to color map via prototype.
Will have the type of the first element, and no index nor be a color cube.
It will not create a new array but mutate the input array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">protoMap</span>: <span class="hljs-function"><span class="hljs-params">(array)</span> -&gt;</span>
    array.type = Color.colorType(array[<span class="hljs-number">0</span>])
    array.__proto__ = ColorMap.prototype
    array <span class="hljs-comment"># this is just the original array, returned for convenience.</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Create a color map via the 140 html standard css color names
or any of the other forms of css color strings.
The input is an array of css strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">cssProtoMap</span>: <span class="hljs-function"><span class="hljs-params">(strings)</span> -&gt;</span> <span class="hljs-property">@protoMap</span> strings</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Equivalent to ColorMap w/ these defaults. Use this for modifying options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">cssColorMap</span>: <span class="hljs-function"><span class="hljs-params">(strings, type=<span class="hljs-string">"css"</span>, indexToo=<span class="hljs-literal">false</span>)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-property">@ColorMap</span> strings, type, indexToo</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Create a color map via an array of pixels, gradientPixelArray for example.
If you don’t have pixel data, call rgbColorMap with type=”pixel”
or simply create your own via:</p>
<p>   pixels = ( rgbaToPixel rgba… for rgba in rgbas )</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">pixelProtoMap</span>: <span class="hljs-function"><span class="hljs-params">(pixels)</span> -&gt;</span> <span class="hljs-property">@protoMap</span> pixels</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Equivalent to ColorMap w/ these defaults. Use this for modifying options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">pixelColorMap</span>: <span class="hljs-function"><span class="hljs-params">(pixels, type=<span class="hljs-string">"pixel"</span>, indexToo=<span class="hljs-literal">false</span>)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-property">@ColorMap</span> pixels, type, indexToo

}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
