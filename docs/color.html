<!DOCTYPE html>

<html>
<head>
  <title>color.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>color.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>ABM.Color = Color = {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Create color object from r,g,b,a
Note a between 0-1, not 0-255
The object contains many properties relating to
the r,g,b,a color:
  r, g, b, h, s, v: color integers, 0-255 based
  a, a255: alpha, a float in 0-1, a255 integer in 0-255
  rgb, hsb: array forms of the two colors
  intensity: the gray value for the rgb color
  rgba, pixel: typed array values.
  rgbString, hexColor: two html/css color formats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">colorObject</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b, a=<span class="hljs-number">1</span>)</span> -&gt;</span>
    o = {r,g,b,a}
    o.a255 = Math.round(a*<span class="hljs-number">255</span>)
    o.rgb = [r, g, b]
    o.hsv = <span class="hljs-property">@rgbToHsv</span> r, g, b
    [o.h, o.s, o.v] = o.hsv</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>o.rgba = new Uint8ClampedArray([r, g, b, o.a255])
o.pixel = new Uint32Array(o.rgba.buffer)[0]
{o.pixel, o.rgba} = typedArrayColor r, g, b, a255</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    {pixel, rgba} = <span class="hljs-property">@typedArrayColor</span> r, g, b, o.a255
    [o.pixel, o.rgba] = [pixel, rgba]
    o.rgbString = <span class="hljs-property">@rgbString</span> r, g, b, a
    o.hexColor = <span class="hljs-property">@hexColor</span> r, g, b
    o.intensity = <span class="hljs-property">@rgbIntensity</span> r, g, b
    o.temp = <span class="hljs-property">@rgbDistance</span> <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, r,g,b
    o</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Color utilities.</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Convert 3 or 4 ints to a html/css color string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbString</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b, a=<span class="hljs-number">1</span>)</span> -&gt;</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"alpha &gt; 1"</span> <span class="hljs-keyword">if</span> a &gt; <span class="hljs-number">1</span> <span class="hljs-comment"># a: 0-1 not 0-255</span>
    <span class="hljs-keyword">if</span> a <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-string">"rgb(<span class="hljs-subst">#{r}</span>,<span class="hljs-subst">#{g}</span>,<span class="hljs-subst">#{b}</span>)"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"rgba(<span class="hljs-subst">#{r}</span>,<span class="hljs-subst">#{g}</span>,<span class="hljs-subst">#{b}</span>,<span class="hljs-subst">#{a}</span>)"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Return the gray/intensity value for a given r,g,b color</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbIntensity</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span> <span class="hljs-number">0.2126</span>*r + <span class="hljs-number">0.7152</span>*g + <span class="hljs-number">0.0722</span>*b</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Return a web/html/css hex color string for an r,g,b color</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">hexColor</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span>
    <span class="hljs-string">"#"</span> + (<span class="hljs-number">0x1000000</span> | (b | g &lt;&lt; <span class="hljs-number">8</span> | r &lt;&lt; <span class="hljs-number">16</span>)).toString(<span class="hljs-number">16</span>).slice(-<span class="hljs-number">6</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Return 2 typed array colors: a single Uint32 pixel, correct endian format,
and a 4 Uint8Array, r,g,b,a255 (i.e. a int in 0-255)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">typedArrayColor</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b, a=<span class="hljs-number">255</span>)</span> -&gt;</span>
    rgba = <span class="hljs-keyword">new</span> Uint8ClampedArray([r, g, b, a])
    pixel = <span class="hljs-keyword">new</span> Uint32Array(rgba.buffer)[<span class="hljs-number">0</span>]
    {pixel, rgba}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Convert rgb color to hsb/hsv color array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbToHsv</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span>
    r=r/<span class="hljs-number">255</span>; g=g/<span class="hljs-number">255</span>; b=b/<span class="hljs-number">255</span>
    max = Math.max(r,g,b); min = Math.min(r,g,b); v = max
    h = <span class="hljs-number">0</span>; d = max-min; s = <span class="hljs-keyword">if</span> max <span class="hljs-keyword">is</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> d/max
    <span class="hljs-keyword">if</span> max <span class="hljs-keyword">isnt</span> min <span class="hljs-keyword">then</span> <span class="hljs-keyword">switch</span> max
      <span class="hljs-keyword">when</span> r <span class="hljs-keyword">then</span> h = (g - b) / d + (<span class="hljs-keyword">if</span> g &lt; b <span class="hljs-keyword">then</span> <span class="hljs-number">6</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)
      <span class="hljs-keyword">when</span> g <span class="hljs-keyword">then</span> h = (b - r) / d + <span class="hljs-number">2</span>
      <span class="hljs-keyword">when</span> b <span class="hljs-keyword">then</span> h = (r - g) / d + <span class="hljs-number">4</span>
    [Math.round(<span class="hljs-number">255</span>*h/<span class="hljs-number">6</span>), Math.round(<span class="hljs-number">255</span>*s), Math.round(<span class="hljs-number">255</span>*v)]</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Convert hsv back to rgb</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">hsvToRgb</span>: <span class="hljs-function"><span class="hljs-params">(h, s, v)</span> -&gt;</span>
    h=h/<span class="hljs-number">255</span>; s=s/<span class="hljs-number">255</span>; v=v/<span class="hljs-number">255</span>; i = Math.floor(h*<span class="hljs-number">6</span>)
    f = h * <span class="hljs-number">6</span> - i;        p = v * (<span class="hljs-number">1</span> - s)
    q = v * (<span class="hljs-number">1</span> - f * s);  t = v * (<span class="hljs-number">1</span> - (<span class="hljs-number">1</span> - f) * s)
    <span class="hljs-keyword">switch</span>(i % <span class="hljs-number">6</span>)
      <span class="hljs-keyword">when</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> r = v; g = t; b = p
      <span class="hljs-keyword">when</span> <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> r = q; g = v; b = p
      <span class="hljs-keyword">when</span> <span class="hljs-number">2</span> <span class="hljs-keyword">then</span> r = p; g = v; b = t
      <span class="hljs-keyword">when</span> <span class="hljs-number">3</span> <span class="hljs-keyword">then</span> r = p; g = q; b = v
      <span class="hljs-keyword">when</span> <span class="hljs-number">4</span> <span class="hljs-keyword">then</span> r = t; g = p; b = v
      <span class="hljs-keyword">when</span> <span class="hljs-number">5</span> <span class="hljs-keyword">then</span> r = v; g = p; b = q
    [Math.round(r*<span class="hljs-number">255</span>), Math.round(g*<span class="hljs-number">255</span>), Math.round(b*<span class="hljs-number">255</span>)] <span class="hljs-comment"># floor??</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Return a distance metric between two colors.
<a href="http://www.compuphase.com/cmetric.htm">http://www.compuphase.com/cmetric.htm</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbDistance</span>: <span class="hljs-function"><span class="hljs-params">(r1, g1, b1, r2, g2, b2)</span> -&gt;</span>
    rMean = Math.round (r1 + r2) / <span class="hljs-number">2</span>
    [dr, dg, db] = [r1 - r2, g1 - g2, b1 - b2]
    Math.sqrt (((<span class="hljs-number">512</span>+rMean)*dr*dr)&gt;&gt;<span class="hljs-number">8</span>) + (<span class="hljs-number">4</span>*dg*dg) + (((<span class="hljs-number">767</span>-rMean)*db*db)&gt;&gt;<span class="hljs-number">8</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>A colormap is an array of ColorObjects which have two additional
properties: map: the colormap and ix: the color’s index w/in map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">ColorMap</span>: <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ColorMap</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Array</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>A colormap is an array of Color objects. Each ColorObject has
two new properties: ix, the array index, and map, the colormap
The ctor takes an array of [r,g,b] arrays. See factories above.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(rgbArray)</span> -&gt;</span>
      <span class="hljs-keyword">super</span>(<span class="hljs-number">0</span>)
      <span class="hljs-keyword">for</span> c, i <span class="hljs-keyword">in</span> rgbArray
        <span class="hljs-property">@push</span> Color.colorObject c... <span class="hljs-comment"># use splats</span>
        @[i].ix = i
        @[i].map = @</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>The Array.sort, augmented by updating color.ix to correspond
to the new place in the array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">sort</span>: <span class="hljs-function"><span class="hljs-params">(f)</span> -&gt;</span>
      <span class="hljs-keyword">super</span> f
      color.ix = i <span class="hljs-keyword">for</span> color, i <span class="hljs-keyword">in</span> @ <span class="hljs-comment"># c: color, i</span>
      @</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Sugar for sorting by color.key, mainly intensity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">sortBy</span>: <span class="hljs-function"><span class="hljs-params">(key, ascenting=<span class="hljs-literal">true</span>)</span> -&gt;</span>
      <span class="hljs-function"><span class="hljs-title">compare</span> = <span class="hljs-params">(a, b)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> ascenting <span class="hljs-keyword">then</span> a[key]-b[key] <span class="hljs-keyword">else</span> b[key]-a[key]
      <span class="hljs-property">@sort</span> compare</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Find an rgb color in the map, return -1 if not found</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">findRGB</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span>
      <span class="hljs-keyword">for</span> color, i <span class="hljs-keyword">in</span> @
        <span class="hljs-keyword">return</span> i <span class="hljs-keyword">if</span> color.r <span class="hljs-keyword">is</span> r <span class="hljs-keyword">and</span> color.g <span class="hljs-keyword">is</span> g <span class="hljs-keyword">and</span> color.b <span class="hljs-keyword">is</span> b
      -<span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Find a color with the given key/value, -1 if not found</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">find</span>: <span class="hljs-function"><span class="hljs-params">(key, value)</span> -&gt;</span>
      <span class="hljs-keyword">for</span> color, i <span class="hljs-keyword">in</span> @
        <span class="hljs-keyword">return</span> color <span class="hljs-keyword">if</span> color[key] <span class="hljs-keyword">is</span> value
      -<span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Return an random color or index in a map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">randomColor</span>:<span class="hljs-function"> -&gt;</span> @[<span class="hljs-property">@randomIndex</span>()]</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Standalone: Math.floor(Math.random() * @length)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">randomIndex</span>:<span class="hljs-function"> -&gt;</span> u.randomInt <span class="hljs-property">@length</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Find the color closest to this rgb color, based on intensity
sum of squares, and closestHSV
<a href="http://en.wikipedia.org/wiki/Color_difference">http://en.wikipedia.org/wiki/Color_difference</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">closestRGB</span>: <span class="hljs-function"><span class="hljs-params">(r, g, b)</span> -&gt;</span>
      minDist = Infinity
      ixMin = <span class="hljs-number">0</span>
      <span class="hljs-keyword">for</span> color, i <span class="hljs-keyword">in</span> @
        d = Color.rgbDistance color.rgb..., r, g, b
        <span class="hljs-keyword">if</span> d &lt; minDist
          minDist = d
          ixMin = i
      @[ixMin]</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Utilities for creating color maps
<a href="https://github.com/bpostlethwaite/colormap">https://github.com/bpostlethwaite/colormap</a></p>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Create a gray map of gray values (gray: r=g=b)
The optional size argument is the size of the map for
maps that are not all 256 grays.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">intensityArray</span>: <span class="hljs-function"><span class="hljs-params">(size = <span class="hljs-number">256</span>)</span> -&gt;</span>
    (Math.round(i*<span class="hljs-number">255</span>/(size-<span class="hljs-number">1</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..size])
  <span class="hljs-attribute">grayColorMap</span>: <span class="hljs-function"><span class="hljs-params">(size = <span class="hljs-number">256</span>)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ColorMap ([i,i,i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-property">@intensityArray</span>(size))</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Create a colormap by rgb values. R, G, B can be either a number,
the number of steps beteen 0-255, or an array of values to use
for the color.  Ex: R = 3, corresponds to [0, 128, 255]
The resulting map permutes the R, G, V values.  Thus if
R=G=B=4, the resulting map has 4<em>4</em>4=64 colors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">rgbColorArray</span>: <span class="hljs-function"><span class="hljs-params">(R,G=R,B=R)</span> -&gt;</span>
    R = (Math.round(i*<span class="hljs-number">255</span>/(R-<span class="hljs-number">1</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..R]) <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> R <span class="hljs-keyword">is</span> <span class="hljs-string">"number"</span>
    G = (Math.round(i*<span class="hljs-number">255</span>/(G-<span class="hljs-number">1</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..G]) <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> G <span class="hljs-keyword">is</span> <span class="hljs-string">"number"</span>
    B = (Math.round(i*<span class="hljs-number">255</span>/(B-<span class="hljs-number">1</span>)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..B]) <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> B <span class="hljs-keyword">is</span> <span class="hljs-string">"number"</span>
    array=[]; ((array.push [r,g,b] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> B) <span class="hljs-keyword">for</span> g <span class="hljs-keyword">in</span> G) <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> R
    array
  <span class="hljs-attribute">rgbColorMap</span>: <span class="hljs-function"><span class="hljs-params">(R,G=R,B=R)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ColorMap <span class="hljs-property">@rgbColorArray</span>(R, G, B)</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Create an hsb map with n hues, with constant saturation
and brightness.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">hsvColorArray</span>: <span class="hljs-function"><span class="hljs-params">(nHues=<span class="hljs-number">256</span>, s=<span class="hljs-number">255</span>, b=<span class="hljs-number">255</span>)</span> -&gt;</span>
    (Color.hsvToRgb(i*<span class="hljs-number">255</span>/(nHues-<span class="hljs-number">1</span>), s, b) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..nHues])
  <span class="hljs-attribute">hsvColorMap</span>: <span class="hljs-function"><span class="hljs-params">(nHues=<span class="hljs-number">256</span>, s=<span class="hljs-number">255</span>, b=<span class="hljs-number">255</span>)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ColorMap <span class="hljs-property">@hsvColorArray</span>(nHues, s, b)</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Use the canvas gradient feature to create nColors.
This is a really sophisticated technique, see:
 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient">https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient</a>
 <a href="http://www.colorzilla.com/gradient-editor/">http://www.colorzilla.com/gradient-editor/</a>
 <a href="https://github.com/bpostlethwaite/colormap">https://github.com/bpostlethwaite/colormap</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">gradientColorArray</span>: <span class="hljs-function"><span class="hljs-params">(nColors, stops, locs)</span> -&gt;</span>
    locs = (i/(stops.length-<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..stops.length]) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> locs?</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>util: ctx = u.createCtx nColors, 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    can = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">"canvas"</span>
    can.width = nColors; can.height = <span class="hljs-number">1</span>
    ctx = can.getContext <span class="hljs-string">"2d"</span>
    grad = ctx.createLinearGradient <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, nColors, <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..stops.length]
      grad.addColorStop locs[i], Color.rgbString(stops[i]...)
    ctx.fillStyle = grad
    ctx.fillRect <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, nColors, <span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>util: id = u.ctxToImageData(ctx).data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    id = (ctx.getImageData <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, nColors, <span class="hljs-number">1</span>).data
    ([id[i], id[i+<span class="hljs-number">1</span>], id[i+<span class="hljs-number">2</span>]] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..id.length] <span class="hljs-keyword">by</span> <span class="hljs-number">4</span>)
  <span class="hljs-attribute">gradientColorMap</span>: <span class="hljs-function"><span class="hljs-params">(nColors, stops, locs)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> ColorMap <span class="hljs-property">@gradientColorArray</span>(nColors, stops, locs)</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Create a color map via the 140 html standard colors.  We use a minimal
string format: “XXXXXXColorName”, the 6 hex digits followed by the name.
Ex: “000000Black” or “FF0000Red”.
The input is a single string of space separated name specs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">nameColorMap</span>: <span class="hljs-function"><span class="hljs-params">(colorsString)</span> -&gt;</span>
    colorStrings = colorsString.split <span class="hljs-string">" "</span>
    names = (colorString.slice(<span class="hljs-number">6</span>) <span class="hljs-keyword">for</span> colorString <span class="hljs-keyword">in</span> colorStrings)
    hexes = (colorString.slice(<span class="hljs-number">0</span>,<span class="hljs-number">6</span>) <span class="hljs-keyword">for</span> colorString <span class="hljs-keyword">in</span> colorStrings)
    <span class="hljs-function"><span class="hljs-title">toint</span> = <span class="hljs-params">(str, start)</span> -&gt;</span> parseInt(str.slice(start,start+<span class="hljs-number">2</span>), <span class="hljs-number">16</span>)
    rgbs = ( [ toint(h,<span class="hljs-number">0</span>), toint(h,<span class="hljs-number">2</span>), toint(h,<span class="hljs-number">4</span>) ] <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> hexes)
    map = <span class="hljs-keyword">new</span> ColorMap rgbs
    <span class="hljs-keyword">for</span> c, i <span class="hljs-keyword">in</span> map
      c.name = names[i]
      map[c.name] = c
      map[c.name.toLowerCase()] = c
    map</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Create a map with a random set of colors.
Sometimes useful to sort by intensity afterwards.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">randomColorMap</span>: <span class="hljs-function"><span class="hljs-params">(nColors)</span> -&gt;</span>
    <span class="hljs-function"><span class="hljs-title">rand255</span> = -&gt;</span> Math.floor(Math.random() * <span class="hljs-number">256</span>) <span class="hljs-comment"># util.randomInt</span>
    <span class="hljs-keyword">new</span> ColorMap ([rand255(), rand255(), rand255()] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..nColors])

};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
